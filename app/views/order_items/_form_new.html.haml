= simple_form_for [@order, @order_item],
  html: { 'data-controller' => 'oprice' },
  defaults: { disabled: local_assigns[:readonly], stimulus: {controller: 'oprice'} },
  wrapper: :horizontal_form do |f|

  .row.post
    .col-6
      = f.association :sku, as: :sku_selection
      = f.input :orderquant, stimulus: {target: :qty, action: 'oprice#updateQty'}
      = f.input :orderitemsurgent
      = f.association :purchase_order, as: :sku_po_history_selection, for_sku: :skuid
    .col-6
      = f.input :popriceper, label: 'PO Price Per + 20%', as: :currency
      = f.input :orderpriceper,   stimulus: { target: 'pricePer', action: 'oprice#updatePrice' }, as: :decimal
      = f.input :orderpricetotal, stimulus: { target: 'priceTotal' }, calculated: true
      = f.input :ordertaxrate,    stimulus: { target: :taxRate }, input_html: { value: @order.ordertaxrate }
      = f.input :ordertaxtotal,   stimulus: { target: 'taxTotal' }, calculated: true
      = f.input :ordergrandtotal, stimulus: { target: 'grandTotal' }, calculated: true

  - unless local_assigns[:readonly]
    .row
      = simple_form_submit(f)

- content_for :scripts do
  = javascript_include_tag "linked_sku_po_selects"

  :coffee
    $(document).ready () ->
      new LinkedSkuPoSelects('#order_item_skuid', '#order_item_poid')

      $('#order_item_poid').on 'select2:select', (e) ->
        price = currency(e.params.data.price)
        $('#order_item_popriceper').val price.multiply(1.2)
